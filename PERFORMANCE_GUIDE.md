# VisionLens AR 性能优化指南

## 当前性能问题分析

FPS保持在15左右低于预期目标，主要原因包括：

1. **MediaPipe FaceLandmarker 过重**：原始的FaceLandmarker比FaceMesh重
2. **检测频率仍然过高**：每3帧检测一次对某些系统来说仍然频繁
3. **图像分辨率**：480x360可能仍然过高
4. **人脸检测置信度**：0.3的阈值可能仍有优化空间

## 优化策略层级

### 🚀 轻度优化（当前版本）
- 分辨率：480x360
- 检测频率：每3帧
- 检测器：FaceLandmarker
- 置信度：0.3

**预期FPS**: 20-25

### ⚡ 中度优化（`main_optimized.py`）
- 分辨率：320x240
- 检测频率：每8帧
- 检测器：FaceLandmarker
- 置信度：0.1
- 移除图像翻转

**预期FPS**: 25-30

### 🔥 极限优化（`main_ultra.py`）
- 分辨率：320x240
- 检测频率：每10帧
- 检测器：FaceMesh（轻量级）
- 置信度：0.1
- 更激进的缓存策略

**预期FPS**: 30-40

## 使用方法

### 1. 原始版本（当前）
```bash
python main.py
```

### 2. 性能调试版本
```bash
python debug_performance.py
```

### 3. 优化版本
```bash
python main_optimized.py
```

### 4. 超高性能版本
```bash
python main_ultra.py
```

## 性能调节参数

### 检测频率调节
- `'+'` 键：增加检测频率（减少间隔帧数）
- `'-'` 键：减少检测频率（增加间隔帧数）

### 性能等级说明
- **绿色 (≥25 FPS)**：优秀性能
- **黄色 (20-24 FPS)**：良好性能
- **橙色 (15-19 FPS)**：一般性能
- **红色 (<15 FPS)**：需要优化

## 进一步优化建议

### 硬件层面
1. **确保GPU可用**：如果有NVIDIA GPU，安装适当的CUDA支持
2. **关闭其他应用**：关闭不必要的后台程序
3. **使用SSD**：确保模型文件在固态硬盘上

### 软件层面
1. **降低饰品图像尺寸**：确保饰品PNG文件不超过200-300px宽度
2. **减少饰品数量**：同时加载多个饰品会降低性能
3. **更新MediaPipe**：使用最新版本可能有性能提升

### 系统层面
1. **摄像头设置**：某些摄像头在特定分辨率下性能更好
2. **电源设置**：确保系统在高性能模式运行
3. **驱动程序**：更新显卡驱动程序

## 性能基准测试

### 测试环境建议
- CPU: Intel i5或更高
- RAM: 8GB或更高
- 摄像头: 30FPS支持

### 预期性能对比

| 版本 | 分辨率 | 检测频率 | 预期FPS | 特点 |
|------|--------|----------|---------|------|
| 原版 | 480x360 | 每3帧 | 15-20 | 基础版本 |
| 优化版 | 480x360 | 每3帧 | 20-25 | 智能缓存 |
| 高性能版 | 320x240 | 每8帧 | 25-30 | 激进优化 |
| 超高性能版 | 320x240 | 每10帧 | 30-40 | 轻量检测器 |

## 故障排除

### FPS仍然很低？
1. 运行 `debug_performance.py` 分析具体瓶颈
2. 尝试逐步降低分辨率
3. 增加检测间隔到12-15帧
4. 检查是否有其他程序占用GPU

### 检测精度下降？
1. 适当提高检测置信度
2. 减少检测间隔
3. 确保光线充足

### 特效跟踪不流畅？
1. 检查landmarks缓存是否正确工作
2. 减少检测间隔以提高响应性
3. 优化饰品图像质量

## 结论

15 FPS对于某些硬件配置来说可能是正常水平。建议：

1. **先尝试超高性能版本**：`python main_ultra.py`
2. **如果仍然低于20 FPS**：可能是硬件限制
3. **如果达到25+ FPS**：说明优化成功
4. **使用调试工具**：`debug_performance.py` 分析具体瓶颈

通过渐进式优化，大多数系统应该能达到25-30 FPS的目标性能。